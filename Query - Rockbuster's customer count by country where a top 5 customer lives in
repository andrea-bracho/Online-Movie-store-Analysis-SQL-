SELECT country.country,
       COUNT (DISTINCT customer.customer_id) AS all_customer_count,
       COUNT (DISTINCT country.country) AS top_customer_count
FROM
(SELECT A.customer_id, 
        B.first_name, 
        D.last_name,
        E.country,
        D.city,
        SUM(amount) AS total_amount_paid
FROM payment A
        INNER JOIN customer B on A.customer_id = B.customer_id
        INNER JOIN address C ON B.address_id = C.address_id
        INNER JOIN city D ON C.city_id = D.city_id
        INNER JOIN country E ON D.country_id = E.country_id
        WHERE E.country IN ('India', 'China', United States',
                  'Japan', 'Mexico', Brazil', Russian Federation',
                  'Philippines', 'Turkey', 'Indonesia')
        GROUP BY A.customer_id,
                 B.first_name, 
                 B.last_name,
                 E.country,
                 D.city
        ORDER BY total_amount_paid DESC
        LIMIT 5) AS top_5_customers
LEFT JOIN customer B on A.customer_id = B.customer_id
LEFT JOIN address C ON B.address_id = C.address_id
LEFT JOIN city D ON C.city_id = D.city_id
LEFT JOIN country E ON D.country_id = E.country_id
GROUP BY E.country
ORDER BY COUNT (country.country) DESC
LIMIT 5;
